<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Updates | NG Extension Manager</title>
    <meta name="description" content="Check for updates, view the latest changelog, manage settings, and see storage usage for the NG Extension Manager.">
    <meta name="color-scheme" content="light dark">
    <link rel="stylesheet" href="../css/updates.css">
    <link rel="stylesheet" href="../../public/fonts/fonts.css">
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <header class="sidebar-header">
                <img src="../../public/icons/svg/updatelogo.svg" alt="NG Extension Manager Logo" class="header-logo no-mask">
                <h1 id="extension-title" class="sidebar-title">Update</h1>
            </header>
            <nav class="sidebar-nav" aria-label="Updates Sections">
                <ul>
                    <li>
                        <button class="sidebar-button active" data-panel-target="panel-status" aria-current="page">
                            <span class="icon icon-info" aria-hidden="true"></span> <span>Status</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-button" data-panel-target="panel-advanced">
                            <span class="icon icon-settings" aria-hidden="true"></span>
                            <span>Advanced</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-button" data-panel-target="panel-changelog" id="nav-changelog">
                            <span class="icon icon-changelog" aria-hidden="true"></span>
                            <span>Changelog</span>
                            <span class="update-indicator" title="Update Available"></span>
                        </button>
                    </li>
                    </ul>
            </nav>
            <footer class="sidebar-footer">
                 <p>&copy; <span id="current-year"></span> NG Extension Manager</p> </footer>
        </aside>

        <main class="content-area">

            <section id="panel-status" class="content-panel active" aria-labelledby="nav-status" tabindex="-1">
                <header class="panel-header">
                    <h2>Update Status</h2>
                    <p>Check the current version status and see if an update is available.</p>
                </header>
                <div class="panel-content">
                    <div class="status-content-wrapper" aria-busy="true">
                        <div class="skeleton-loader" aria-hidden="true">
                            <div class="skeleton skeleton-line short" style="height: 1.5rem; width: 30%; margin-bottom: 1rem;"></div>
                            <div class="skeleton skeleton-line medium" style="height: 1.2rem; width: 50%;"></div>
                            <div class="skeleton skeleton-line" style="height: 1rem; width: 70%; margin-bottom: 1.5rem;"></div>
                            <div class="skeleton skeleton-line small" style="height: 0.9rem; width: 40%; margin-bottom: 2rem;"></div>
                            <div class="skeleton-actions">
                                 <div class="skeleton skeleton-button small" style="width: 45px;"></div>
                                 <div class="skeleton skeleton-button" style="width: 160px;"></div>
                                 <div class="skeleton skeleton-button" style="width: 200px;"></div>
                            </div>
                        </div>
                        <div class="status-card-content">
                            <div class="status-primary">
                                <div id="status-indicator-wrapper" class="status-indicator-wrapper" aria-label="Initializing status check" aria-live="polite">
                                    <span id="status-icon-wrapper"><span class="icon icon-loading loading" id="status-icon" aria-hidden="true"></span></span>
                                    <span id="status-message" class="status-message">Initializing...</span>
                                </div>
                                <div class="status-meta">
                                    <button id="refresh-check" class="btn icon-btn refresh-btn" title="Refresh update status" aria-label="Refresh update status">
                                         <span class="icon icon-retry" aria-hidden="true"></span>
                                    </button>
                                    <span class="last-checked" id="last-checked-time" title="Time of the last successful check">Never checked</span>
                                </div>
                            </div>
                            <div id="api-error-message" class="api-error-display" style="display: none;" role="alert" aria-atomic="true"></div>

                            <div class="status-actions">
                                 <button id="download-button" class="btn primary" disabled aria-disabled="true">
                                    <span class="icon icon-install" aria-hidden="true"></span>
                                    Download Latest
                                </button>
                                <a id="view-all-releases-link" href="#" target="_blank" rel="noopener noreferrer" class="btn secondary">
                                     <span class="icon icon-link" aria-hidden="true"></span>
                                     View All Releases
                                </a>
                                <button id="view-changelog-button" class="btn tertiary" style="display: none;"> <span class="icon icon-changelog" aria-hidden="true"></span>
                                     View Changelog </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="panel-advanced" class="content-panel" aria-labelledby="nav-advanced" hidden tabindex="-1">
                <header class="panel-header">
                    <h2>Advanced Information & Settings</h2>
                    <p>View detailed version info, manage cache, check storage usage, and see GitHub details.</p>
                </header>
                <div class="panel-content">
                    <div class="content-section">
                        <h3 class="section-title">Version Details</h3>
                         <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label" id="installed-version-label">Installed Version</span>
                                <div class="detail-value-wrapper">
                                    <strong id="installed-version" class="detail-value" aria-labelledby="installed-version-label">0.0.0</strong>
                                    <button class="btn icon-btn copy-btn" data-copy-target="installed-version" title="Copy Installed Version" aria-label="Copy Installed Version">
                                        <span class="icon icon-id small" aria-hidden="true"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label" id="latest-version-label">Latest Available Version</span>
                                <div class="detail-value-wrapper">
                                    <strong id="latest-version" class="detail-value" aria-labelledby="latest-version-label">N/A</strong>
                                    <button class="btn icon-btn copy-btn" data-copy-target="latest-version" title="Copy Latest Version" aria-label="Copy Latest Version">
                                        <span class="icon icon-id small" aria-hidden="true"></span>
                                    </button>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label" id="latest-release-date-label">Latest Release Date</span>
                                <span id="latest-release-date-adv" class="detail-value text-muted" aria-labelledby="latest-release-date-label">N/A</span>
                            </div>
                            </div>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">Cache Management</h3>
                        <p class="description">The extension caches release information from GitHub to speed up checks and reduce API usage. This cache typically lasts for about an hour.</p>
                        <div class="details-grid cache-details">
                            <div class="detail-item">
                                <span class="detail-label">Estimated Cache Data Usage</span>
                                <div class="detail-value-wrapper">
                                    <strong id="cache-usage" class="detail-value storage-value" aria-live="polite">Calculating...</strong>
                                    <span id="cache-usage-error" class="storage-error" style="display: none;"></span>
                                </div>
                            </div>
                            <div class="detail-item detail-item-full-width">
                                 <span class="detail-label">Cache Actions</span>
                                 <div class="cache-controls">
                                     <button id="clear-cache-button" class="btn tertiary" title="Clear all cached version data and force refresh">
                                        <span class="icon icon-trash" aria-hidden="true"></span>
                                        Clear All Cached Data
                                     </button>
                                     <button id="clear-etag-button" class="btn tertiary" title="Clear only the ETag to force a data re-fetch on next check">
                                        <span class="icon icon-refresh-alt" aria-hidden="true"></span> Force Data Refresh
                                     </button>
                                 </div>
                                 <p class="description small-description">Clearing cache forces an immediate check against GitHub but may consume API rate limit. Forcing refresh is useful if you suspect the cache is stale.</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">Extension Storage Usage</h3>
                        <p class="description">Displays estimated storage used by the extension for its settings and other data. This does not include the extension's installation size.</p>
                        <div class="details-grid storage-details">
                            <div class="detail-item">
                                <span class="detail-label" title="Persistent extension storage (synced if enabled)">Chrome Storage (Local)</span>
                                <div class="detail-value-wrapper">
                                    <strong id="chrome-storage-usage" class="detail-value storage-value" aria-live="polite">Calculating...</strong>
                                    <span id="chrome-storage-error" class="storage-error" style="display: none;"></span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label" title="Browser's local storage for this extension origin">Web localStorage</span>
                                <div class="detail-value-wrapper">
                                    <strong id="local-storage-usage" class="detail-value storage-value" aria-live="polite">Calculating...</strong>
                                    <span id="local-storage-error" class="storage-error" style="display: none;"></span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label" title="Browser's session storage (cleared when browser closes)">Web sessionStorage</span>
                                <div class="detail-value-wrapper">
                                    <strong id="session-storage-usage" class="detail-value storage-value" aria-live="polite">Calculating...</strong>
                                    <span id="session-storage-error" class="storage-error" style="display: none;"></span>
                                </div>
                            </div>
                        </div>
                         <p class="description small-description">Values are estimates. Chrome Storage is preferred for extension settings. Web Storage usage might indicate temporary data or older configurations.</p>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">GitHub Information</h3>
                        <p class="description">Details about the connection to GitHub for fetching update information.</p>
                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">Repository Path</span>
                                <code id="github-repo-path" class="detail-value">N/A</code>
                            </div>
                             <div class="detail-item">
                                <span class="detail-label">API Requests Remaining</span>
                                <span id="api-rate-limit" class="detail-value">N/A</span>
                                <span id="api-rate-limit-reset" class="detail-value-small"></span>
                            </div>
                            </div>
                    </div>

                </div>
            </section>

            <section id="panel-changelog" class="content-panel" aria-labelledby="nav-changelog" hidden tabindex="-1">
                 <header class="panel-header">
                    <h2 id="changelog-heading-main">Latest Release Notes</h2>
                    <p>See what changed in the most recent version found.</p>
                 </header>
                 <div class="panel-content">
                    <div id="changelog-content-wrapper" class="content-section">
                         <h3 id="changelog-version-heading" class="section-title">Version N/A</h3>
                         <article id="changelog-content" class="changelog-body markdown-content" aria-live="polite" aria-atomic="false">
                              <div class="skeleton-loader-inline" aria-hidden="true"> <div class="skeleton skeleton-line long"></div>
                                   <div class="skeleton skeleton-line"></div>
                                   <div class="skeleton skeleton-line medium"></div>
                                   <div class="skeleton skeleton-line short"></div>
                                   <div class="skeleton skeleton-line long"></div>
                              </div>
                              </article>
                    </div>
                </div>
            </section>

            <footer class="content-footer" role="contentinfo">
                <div class="infobox">
                    <p>Need help? Visit the <a href="https://sites.google.com/view/ng-extension-manager/ng-extension-manager/help-tutorials?authuser=0" target="_blank" rel="noopener noreferrer">support page</a> or check the <a href="https://sites.google.com/view/ng-extension-manager/home?authuser=0" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
                </div>
            </footer>
        </main>
    </div>

    <div id="toast-container" role="log" aria-live="assertive" aria-relevant="additions"></div>

    <script src="../js/markdown.js"></script>
    <script src="../js/updates.js"></script>
    </body>
</html>
