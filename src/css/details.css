/* ==========================================================================
   Base Styles, Variables & Automatic Theming v1.2 (Details Page - JSON Perms, Layout)
   Based on Updates Page Styles v3.2
   ========================================================================== */

/* Define Light Theme Variables and Base Styles */
:root {
  /* Core Palette (Light) - Same as Updates */
  --primary-color: #007aff; --primary-hover-color: #005ecb; --primary-active-color: #004bad; --primary-rgb: 0, 122, 255;
  --secondary-color: #8e8e93; --secondary-hover-color: #a0a0a5; --secondary-active-color: #b2b2b7;
  --success-color: #34c759; --success-rgb: 52, 199, 89;
  --warning-color: #ff9500; --warning-rgb: 255, 149, 0;
  --danger-color: #ff3b30; --danger-rgb: 255, 59, 48;
  --info-color: #5ac8fa; --info-rgb: 90, 200, 250;

  /* Backgrounds & Text (Light) - Same as Updates */
  --bg-primary: #ffffff; --bg-secondary: #f2f2f7; --bg-tertiary: #e5e5ea;
  --text-primary: #1c1c1e; --text-secondary: #3c3c43; --text-muted: #636366; --text-disabled: rgba(60, 60, 67, 0.3);
  --text-link: var(--primary-color); --text-success: #28a745; --text-warning: #d97e00; --text-danger: #c51f1a; --text-info: #007aff;

  /* Borders, Shadows, etc (Light) - Same as Updates */
  --border-color: #c6c6c8; --border-color-light: #d1d1d6;
  --focus-ring-color: rgba(var(--primary-rgb), 0.3); --selection-background: rgba(var(--primary-rgb), 0.2); --selection-text: inherit;
  --scrollbar-thumb: #b2b2b7; --scrollbar-thumb-hover: #8e8e93;
  --shadow-color: rgba(0, 0, 0, 0.08);
  --icon-color: var(--text-secondary); --icon-color-active: var(--primary-color);
  --skeleton-bg: #e1e1e1; --skeleton-highlight: #f0f0f0;

  /* Typography & Layout - Same as Updates */
  --font-family-sans-serif: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  --font-family-monospace: "SF Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --base-font-size: 16px; --line-height-base: 1.6; --spacing-unit: 1rem;
  --sidebar-width: 240px; --container-padding: calc(var(--spacing-unit) * 1.75);
  --border-radius: 10px; --border-radius-small: 6px; --border-width: 1px; --focus-ring-width: 3px;

  /* Transitions & Shadows - Same as Updates */
  --transition-speed-fast: 0.15s; --transition-speed-normal: 0.25s;
  --transition-base: all var(--transition-speed-fast) ease-in-out;
  --shadow-sm: 0 1px 2px 0 var(--shadow-color); --shadow: 0 3px 8px 0 var(--shadow-color); --shadow-lg: 0 6px 16px 0 var(--shadow-color);
  --focus-ring: 0 0 0 var(--focus-ring-width) var(--focus-ring-color);

  /* Risk Colors */
  --risk-low-color: #34c759; /* Success */
  --risk-medium-color: #ff9500; /* Warning */
  --risk-high-color: #ff3b30; /* Danger */
  --risk-varies-color: #8e8e93; /* Secondary */
  --risk-low-bg: rgba(52, 199, 89, 0.1);
  --risk-medium-bg: rgba(255, 149, 0, 0.1);
  --risk-high-bg: rgba(255, 59, 48, 0.1);
  --risk-varies-bg: rgba(142, 142, 147, 0.1);
}

/* Dark Theme Overrides - Same as Updates + Risk Colors */
@media (prefers-color-scheme: dark) {
  :root {
      --primary-color: #0a84ff; --primary-hover-color: #349dff; --primary-active-color: #5aaeff; --primary-rgb: 10, 132, 255;
      --secondary-color: #8e8e93; --secondary-hover-color: #aaaab3; --secondary-active-color: #cacace;
      --success-color: #30d158; --success-rgb: 48, 209, 88; --warning-color: #ff9f0a; --warning-rgb: 255, 159, 10; --danger-color: #ff453a; --danger-rgb: 255, 69, 58; --info-color: #64d2ff; --info-rgb: 100, 210, 255;
      --bg-primary: #1c1c1e; --bg-secondary: #000000; --bg-tertiary: #2c2c2e;
      --text-primary: #ffffff; --text-secondary: rgba(235, 235, 245, 0.6); --text-muted: #8e8e93; --text-disabled: rgba(235, 235, 245, 0.3);
      --text-link: var(--primary-color); --text-success: var(--success-color); --text-warning: var(--warning-color); --text-danger: var(--danger-color); --text-info: #64d2ff;
      --border-color: #38383a; --border-color-light: #2c2c2e;
      --focus-ring-color: rgba(var(--primary-rgb), 0.5); --selection-background: rgba(var(--primary-rgb), 0.3);
      --scrollbar-thumb: #505054; --scrollbar-thumb-hover: #6e6e73;
      --shadow-color: rgba(0, 0, 0, 0.4);
      --icon-color: var(--text-secondary); --icon-color-active: var(--primary-color);
      --skeleton-bg: #2c2c2e; --skeleton-highlight: #3a3a3c;

      /* Risk Colors Dark */
      --risk-low-color: #30d158;
      --risk-medium-color: #ff9f0a;
      --risk-high-color: #ff453a;
      --risk-varies-color: #aaaab3; /* Lighter secondary */
      --risk-low-bg: rgba(48, 209, 88, 0.15);
      --risk-medium-bg: rgba(255, 159, 10, 0.15);
      --risk-high-bg: rgba(255, 69, 58, 0.15);
      --risk-varies-bg: rgba(170, 170, 179, 0.15);
  }
}

/* ==========================================================================
 Global Styles & Reset - Same as Updates
 ========================================================================== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
::selection { background: var(--selection-background); color: var(--selection-text); }
::-webkit-scrollbar { width: 10px; height: 10px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 5px; border: 3px solid var(--bg-primary); }
::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover); }
html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; height: 100%; }
body { font-family: var(--font-family-sans-serif); background-color: var(--bg-secondary); color: var(--text-primary); line-height: var(--line-height-base); font-size: var(--base-font-size); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; transition: background-color var(--transition-speed-normal), color var(--transition-speed-normal); min-height: 100%; display: flex; }
a { color: var(--text-link); text-decoration: none; }
a:hover { text-decoration: underline; }
code {
  font-family: var(--font-family-monospace);
  background-color: var(--bg-tertiary);
  padding: 0.1em 0.4em;
  border-radius: var(--border-radius-small);
  font-size: 95%; /* Base size */
  color: var(--text-secondary);
  border: 1px solid var(--border-color-light);
  word-break: break-all;
}strong { font-weight: 600; }

/* ==========================================================================
 Icon Styling - Ensure all needed icons are defined
 ========================================================================== */
.icon { display: inline-block; width: 1.1em; height: 1.1em; background-color: currentColor; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; vertical-align: middle; flex-shrink: 0; color: var(--icon-color); transition: background-color var(--transition-speed-fast); }
/* Ensure ALL required icons are here */
.icon-info { -webkit-mask-image: url(../../public/icons/svg/info.svg); mask-image: url(../../public/icons/svg/info.svg); }
.icon-settings { -webkit-mask-image: url(../../public/icons/svg/settings.svg); mask-image: url(../../public/icons/svg/settings.svg); }
.icon-shield { -webkit-mask-image: url(../../public/icons/svg/shield.svg); mask-image: url(../../public/icons/svg/shield.svg); }
.icon-diagnostic { -webkit-mask-image: url(../../public/icons/svg/diagnostics.svg); mask-image: url(../../public/icons/svg/diagnostics.svg); }
.icon-link { -webkit-mask-image: url(../../public/icons/svg/link.svg); mask-image: url(../../public/icons/svg/link.svg); }
.icon-id { -webkit-mask-image: url(../../public/icons/svg/id.svg); mask-image: url(../../public/icons/svg/id.svg); }
.icon-trash { -webkit-mask-image: url(../../public/icons/svg/trash.svg); mask-image: url(../../public/icons/svg/trash.svg); }
.icon-store { -webkit-mask-image: url(../../public/icons/svg/store.svg); mask-image: url(../../public/icons/svg/store.svg); }
.icon-toggle-on { -webkit-mask-image: url(../../public/icons/svg/power.svg); mask-image: url(../../public/icons/svg/power.svg); }
.icon-toggle-off { -webkit-mask-image: url(../../public/icons/svg/power.svg); mask-image: url(../../public/icons/svg/power.svg); }
/* **FIXED PATH:** Assuming reload.svg is present at this corrected relative path from CSS */
.icon-reload { -webkit-mask-image: url(../../public/icons/svg/retry.svg); mask-image: url(../../public/icons/svg/retry.svg); }
.icon-api { -webkit-mask-image: url(../../public/icons/svg/api.svg); mask-image: url(../../public/icons/svg/api.svg); }
.icon-host { -webkit-mask-image: url(../../public/icons/svg/host.svg); mask-image: url(../../public/icons/svg/host.svg); }
.icon-loading { -webkit-mask-image: url(../../public/icons/svg/loading.svg); mask-image: url(../../public/icons/svg/loading.svg); }
.icon-check { -webkit-mask-image: url(../../public/icons/svg/check.svg); mask-image: url(../../public/icons/svg/check.svg); }
.icon-warning { -webkit-mask-image: url(../../public/icons/svg/warning.svg); mask-image: url(../../public/icons/svg/warning.svg); }
.icon-error { -webkit-mask-image: url(../../public/icons/svg/error.svg); mask-image: url(../../public/icons/svg/error.svg); }
.icon-help { -webkit-mask-image: url(../../public/icons/svg/help.svg); mask-image: url(../../public/icons/svg/help.svg); }
.icon-copy { -webkit-mask-image: url(../../public/icons/svg/copy.svg); mask-image: url(../../public/icons/svg/copy.svg); } /* New */
.icon-search { -webkit-mask-image: url(../../public/icons/svg/search.svg); mask-image: url(../../public/icons/svg/search.svg); } /* New */
.icon-list { -webkit-mask-image: url(../../public/icons/svg/list.svg); mask-image: url(../../public/icons/svg/list.svg); } /* New */
.icon-grid { -webkit-mask-image: url(../../public/icons/svg/grid.svg); mask-image: url(../../public/icons/svg/grid.svg); } /* New */


/* Icon Sizes */
.sidebar-button .icon { width: 1.2em; height: 1.2em; margin-right: 0.75em; opacity: 0.9; }
.btn .icon { width: 1.1em; height: 1.1em; }
.btn-icon .icon { width: 1.2em; height: 1.2em; } /* Icon only button */
.permission-item-header .icon { margin-right: 0.5em; width: 1em; height: 1em; }
.diag-item .icon { width: 1.3em; height: 1.3em; margin-right: 0.7em;}
.permissions-search .icon { position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); width: 1em; height: 1em; color: var(--text-muted); pointer-events: none; }
.infobox .icon { margin-right: 0.5em; width: 1.1em; height: 1.1em; color: var(--text-secondary); }

/* Icon Colors */
.sidebar-button:hover .icon, .btn:hover .icon { color: var(--text-primary); }
.sidebar-button.active .icon { color: var(--icon-color-active); opacity: 1; }
button.btn.primary .icon, button.btn.danger:not(.tertiary) .icon { color: #fff; }
button.btn.tertiary:hover .icon, .btn-icon:hover .icon { color: var(--primary-color); }
button.btn.danger.tertiary:hover .icon { color: var(--danger-color); }
.btn-icon.active .icon { color: var(--primary-color); }
#enable-toggle-button.enabled .icon-toggle-on { color: var(--success-color); }
#enable-toggle-button:not(.enabled) .icon-toggle-off { color: var(--text-muted); }
.diag-item.success .icon { color: var(--success-color); }
.diag-item.warning .icon { color: var(--warning-color); }
.diag-item.error .icon { color: var(--danger-color); }
.diag-item.info .icon, .info-message .icon { color: var(--info-color); }

/* Loading Icon Animation */
.icon.loading { animation: spin 1s linear infinite; }

/* Header Logo */
img.header-logo.no-mask { width: 40px; height: 40px; border-radius: var(--border-radius-small); vertical-align: middle; object-fit: contain; flex-shrink: 0; filter: none !important; background: var(--bg-primary) !important; border: 1px solid var(--border-color-light); padding: 2px; }

/* ==========================================================================
 Page Layout & Structure (Sidebar Layout) - Adjustments
 ========================================================================== */
.page-wrapper { display: flex; width: 100%; min-height: 100vh; background-color: var(--bg-secondary); }
.sidebar { width: var(--sidebar-width); background-color: var(--bg-primary); border-right: var(--border-width) solid var(--border-color); display: flex; flex-direction: column; padding: var(--spacing-unit); flex-shrink: 0; transition: background-color var(--transition-speed-normal), width var(--transition-speed-normal); box-shadow: var(--shadow); position: fixed; left: 0; top: 0; height: 100vh; z-index: 10; overflow-x: hidden; }
.sidebar-header { display: flex; align-items: center; padding: var(--spacing-unit) calc(var(--spacing-unit) * 0.5); margin-bottom: calc(var(--spacing-unit) * 1.5); gap: var(--spacing-unit); flex-shrink: 0; }
.sidebar-title { font-size: 1.1rem; font-weight: 600; color: var(--text-primary); line-height: 1.3; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sidebar-nav { flex-grow: 1; overflow-y: auto; overflow-x: hidden; /* Firefox scrollbar */ scrollbar-width: thin; scrollbar-color: var(--scrollbar-thumb) transparent; }
.sidebar-nav ul { list-style: none; }
.sidebar-nav li { margin-bottom: calc(var(--spacing-unit) * 0.3); }
.sidebar-button { font-family: inherit; font-size: 0.95rem; font-weight: 500; color: var(--text-secondary); background-color: transparent; border: none; border-radius: var(--border-radius-small); padding: calc(var(--spacing-unit) * 0.7) calc(var(--spacing-unit) * 1); cursor: pointer; transition: background-color var(--transition-speed-fast), color var(--transition-speed-fast), box-shadow var(--transition-speed-fast); display: flex; align-items: center; width: 100%; text-align: left; position: relative; overflow: hidden; white-space: nowrap; }
.sidebar-button span:not(.icon) { flex-grow: 1; overflow: hidden; text-overflow: ellipsis; }
.sidebar-button:hover:not(:disabled) { background-color: var(--bg-tertiary); color: var(--text-primary); }
.sidebar-button.active, .sidebar-button[aria-current="page"] { background-color: rgba(var(--primary-rgb), 0.1); color: var(--primary-color); font-weight: 600; }
.sidebar-button.active .icon, .sidebar-button[aria-current="page"] .icon { color: var(--icon-color-active); opacity: 1; }
.sidebar-button:focus-visible { outline: none; box-shadow: inset 0 0 0 2px var(--focus-ring-color); }
.sidebar-button:disabled, .sidebar-button.disabled { opacity: 0.5; cursor: not-allowed; background-color: transparent !important; color: var(--text-disabled) !important; }
.sidebar-button:disabled .icon, .sidebar-button.disabled .icon { color: var(--text-disabled) !important; }
.sidebar-footer { margin-top: auto; padding-top: var(--spacing-unit); border-top: var(--border-width) solid var(--border-color-light); text-align: center; font-size: 0.8rem; color: var(--text-muted); flex-shrink: 0; white-space: nowrap; overflow: hidden; }

/* Content Area */
.content-area { flex-grow: 1; padding: calc(var(--container-padding) * 1.5); margin-left: var(--sidebar-width); display: flex; flex-direction: column; overflow-y: auto; transition: margin-left var(--transition-speed-normal); position: relative; }
.content-area.disabled-state { filter: grayscale(50%); opacity: 0.7; pointer-events: none; }

.content-panel { background-color: transparent; outline: none; display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * 1.5); flex-grow: 1; }
.content-panel:focus-visible { box-shadow: inset 0 0 0 var(--focus-ring-width) var(--focus-ring-color); border-radius: var(--border-radius); }
.content-panel[hidden] { display: none; }

.panel-header { padding-bottom: var(--spacing-unit); margin-bottom: calc(var(--spacing-unit) * 1); border-bottom: var(--border-width) solid var(--border-color); }
.panel-header h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 0.25em; color: var(--text-primary); }
.panel-header p { color: var(--text-secondary); font-size: 1rem; max-width: 70ch; line-height: 1.5; }

/* Make panel content slightly less imposing */
.panel-content { background-color: var(--bg-primary); padding: var(--container-padding); border-radius: var(--border-radius); box-shadow: var(--shadow); flex-grow: 1; display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * 2); /* Increased gap */ position: relative; min-height: 250px; }

/* Section Styling */
.content-section { padding-bottom: calc(var(--spacing-unit) * 1.5); margin-bottom: calc(var(--spacing-unit) * 1.5); border-bottom: var(--border-width) solid var(--border-color-light); position: relative; }
.content-section.permissions-section { border-bottom: none; padding-bottom: 0; margin-bottom: calc(var(--spacing-unit) * 1.5); } /* Adjusted margin */
.content-section:last-child { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
.section-title { font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: calc(var(--spacing-unit) * 1.25); display: block; }
.section-title.small-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.03em; color: var(--text-muted); margin-bottom: calc(var(--spacing-unit) * 0.75); }
p.description { font-size: 0.95rem; /* Slightly larger */ color: var(--text-secondary); margin-bottom: var(--spacing-unit); max-width: 70ch; line-height: 1.6; }
p.small-description { font-size: 0.85rem; /* Slightly larger */ color: var(--text-muted); margin-top: calc(var(--spacing-unit) * 0.5); margin-bottom: 0; max-width: 65ch; line-height: 1.5; }

/* Help List in Troubleshooting */
ul.help-list { list-style: disc; padding-left: calc(var(--spacing-unit) * 1.5); margin-top: calc(var(--spacing-unit) * 0.75); font-size: 0.9rem; color: var(--text-secondary); }
ul.help-list li { margin-bottom: calc(var(--spacing-unit) * 0.5); line-height: 1.5; }


/* Content Footer */
.content-footer { padding-top: calc(var(--spacing-unit) * 2); margin-top: auto; text-align: center; color: var(--text-muted); font-size: 0.875rem; }
.content-footer .infobox { display: flex; align-items: center; margin-bottom: var(--spacing-unit); padding: var(--spacing-unit); background: var(--bg-tertiary); border-radius: var(--border-radius-small); font-size: 0.875rem; border: 1px solid var(--border-color); color: var(--text-secondary); text-align: left; }

/* General Error Display */
.api-error-display { display: flex; align-items: center; gap: 0.8em; background-color: rgba(var(--danger-rgb), 0.1); color: var(--text-danger); padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 1.5); margin: 0 0 var(--spacing-unit) 0; font-size: 0.95rem; border: 1px solid rgba(var(--danger-rgb), 0.2); border-left: 4px solid var(--danger-color); border-radius: var(--border-radius-small); font-weight: 500; }
.api-error-display strong { margin-right: 0; }
.api-error-display .icon { color: var(--danger-color); width: 1.2em; height: 1.2em; }

/* ==========================================================================
 Skeleton Loaders & Initial Loading - Same as before
 ========================================================================== */
.loading-overlay { position: fixed; /* Use fixed for full viewport coverage */ inset: 0; background-color: rgba(242, 242, 247, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; /* Higher z-index */ text-align: center; color: var(--text-secondary); backdrop-filter: blur(3px); }
@media (prefers-color-scheme: dark) { .loading-overlay { background-color: rgba(0, 0, 0, 0.9); } }
.spinner { width: 40px; height: 40px; border: 4px solid var(--border-color); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: var(--spacing-unit); }
.loading-overlay p { font-size: 1.1rem; font-weight: 500; }

/* Skeleton Placeholders */
.skeleton-loader { position: absolute; inset: 0; z-index: 10; background-color: var(--bg-primary); padding: var(--container-padding); display: none; pointer-events: none; border-radius: var(--border-radius); }
.content-section .skeleton-loader { padding: 0; background: none; border-radius: 0; }
/* Direct child containers need relative positioning */
#details-content-wrapper, #details-actions-content,
#permissions-content-wrapper, #diag-action-items, #diagnosis-results-list { position: relative; }

/* Control visibility based on aria-busy */
[aria-busy="true"] > .skeleton-loader { display: block; }
[aria-busy="true"] > *:not(.skeleton-loader) { visibility: hidden; opacity: 0; }
[aria-busy="false"] > .skeleton-loader { display: none; }
[aria-busy="false"] > *:not(.skeleton-loader) { visibility: visible; opacity: 1; transition: opacity 0.2s ease-in; }

.skeleton { background-color: var(--skeleton-bg); border-radius: var(--border-radius-small); margin-bottom: var(--spacing-unit); position: relative; overflow: hidden; }
.skeleton::after { content: ''; position: absolute; top: 0; left: -150%; width: 150%; height: 100%; background: linear-gradient(90deg, transparent, var(--skeleton-highlight), transparent); animation: shimmer 1.5s infinite linear; }
.skeleton-title { height: 1.8rem; width: 40%; margin-bottom: 1.2rem; }
.skeleton-line { height: 1rem; width: 90%; margin-bottom: 0.75rem; }
.skeleton-line.short { width: 60%; }
.skeleton-line.medium { width: 75%; }
.skeleton-line.long { width: 100%; }
.skeleton-line.small { width: 40%; }
.skeleton-button { height: 2.5rem; width: 150px; border-radius: var(--border-radius-small); display: inline-block; margin-right: var(--spacing-unit); }

/* Specific Skeleton Structures */
.permission-item-skeleton { height: 4rem; width: 100%; margin-bottom: var(--spacing-unit); }
.actions-skeleton .skeleton-button, .diag-actions-skeleton .skeleton-button { margin-bottom: 0; }

@keyframes shimmer { 0% { left: -150%; } 100% { left: 150%; } }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* ==========================================================================
 Button Styles - Added Icon Button
 ========================================================================== */
button.btn, a.btn { /* Base Button Styles */ font-family: inherit; padding: 0.7rem 1.3rem; font-size: 0.95rem; font-weight: 600; border-radius: var(--border-radius-small); border: var(--border-width) solid transparent; cursor: pointer; transition: background-color var(--transition-speed-fast), border-color var(--transition-speed-fast), color var(--transition-speed-fast), box-shadow var(--transition-speed-fast), transform var(--transition-speed-fast); text-align: center; line-height: 1.5; display: inline-flex; align-items: center; justify-content: center; gap: 0.6rem; user-select: none; white-space: nowrap; text-decoration: none; transform: translateY(0); box-shadow: var(--shadow-sm); }
button.btn:disabled, button.btn[aria-disabled="true"], a.btn[aria-disabled="true"] { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; background-color: var(--bg-tertiary); color: var(--text-disabled); border-color: transparent; }
button.btn:not(:disabled):not([aria-disabled="true"]):hover, a.btn:not([aria-disabled="true"]):hover { text-decoration: none; transform: translateY(-1px); box-shadow: var(--shadow); }
button.btn:not(:disabled):not([aria-disabled="true"]):active, a.btn:not([aria-disabled="true"]):active { transform: translateY(0); box-shadow: var(--shadow-sm); filter: brightness(0.95); }
button.btn:focus-visible, a.btn:focus-visible { outline: none; box-shadow: var(--focus-ring), var(--shadow); z-index: 1; }
/* Colors: Primary, Secondary, Tertiary, Danger */
button.btn.primary { color: #fff; background-color: var(--primary-color); border-color: var(--primary-color); }
button.btn.primary:not(:disabled):not([aria-disabled="true"]):hover { background-color: var(--primary-hover-color); border-color: var(--primary-hover-color); }
button.btn.primary:not(:disabled):not([aria-disabled="true"]):active { background-color: var(--primary-active-color); border-color: var(--primary-active-color); }
button.btn.secondary { color: var(--text-primary); background-color: var(--bg-tertiary); border-color: var(--border-color); box-shadow: none; }
button.btn.secondary:not(:disabled):not([aria-disabled="true"]):hover { background-color: var(--border-color); border-color: var(--secondary-hover-color); box-shadow: var(--shadow-sm); }
button.btn.secondary:not(:disabled):not([aria-disabled="true"]):active { background-color: var(--border-color-light); border-color: var(--secondary-active-color); box-shadow: none; }
button.btn.tertiary { color: var(--text-secondary); background-color: transparent; border-color: transparent; font-weight: 500; box-shadow: none; }
button.btn.tertiary:not(:disabled):not([aria-disabled="true"]):hover { color: var(--primary-color); background-color: rgba(var(--primary-rgb), 0.1); transform: none; box-shadow: none; }
button.btn.tertiary:not(:disabled):not([aria-disabled="true"]):active { background-color: rgba(var(--primary-rgb), 0.15); transform: none; filter: none; }
button.btn.danger { color: #fff; background-color: var(--danger-color); border-color: var(--danger-color); }
button.btn.danger:not(:disabled):not([aria-disabled="true"]):hover { background-color: #d9352b; border-color: #d9352b; }
button.btn.danger:not(:disabled):not([aria-disabled="true"]):active { background-color: #b62c24; border-color: #b62c24; }
button.btn.danger.tertiary { background: none; border: none; color: var(--danger-color); font-weight: 500; }
button.btn.danger.tertiary:not(:disabled):not([aria-disabled="true"]):hover { color: var(--danger-color); background-color: rgba(var(--danger-rgb), 0.1); transform: none; box-shadow: none; }
button.btn.danger.tertiary:not(:disabled):not([aria-disabled="true"]):active { background-color: rgba(var(--danger-rgb), 0.15); transform: none; filter: none; }

/* Icon Only Button */
button.btn-icon { background: none; border: none; padding: 0.4rem; border-radius: var(--border-radius-small); cursor: pointer; color: var(--icon-color); transition: background-color var(--transition-speed-fast), color var(--transition-speed-fast); line-height: 0; }
button.btn-icon:hover { background-color: var(--bg-tertiary); color: var(--primary-color); }
button.btn-icon:focus-visible { outline: none; box-shadow: inset 0 0 0 2px var(--focus-ring-color); }
button.btn-icon:disabled { opacity: 0.5; cursor: not-allowed; color: var(--text-disabled); background: none; }
button.btn-icon.active { background-color: rgba(var(--primary-rgb), 0.1); color: var(--primary-color); }

/* ==========================================================================
 Details Panel Specifics - Minor Adjustments
 ========================================================================== */
.details-view { padding-top: var(--spacing-unit); } /* Add padding to actual content */
.details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Slightly wider min */ gap: calc(var(--spacing-unit) * 1.75) calc(var(--spacing-unit) * 2); }
.detail-item { display: flex; flex-direction: column; gap: 0.3em; }
.detail-item.detail-item-full-width { grid-column: 1 / -1; }
.detail-label { font-size: 0.8rem; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.03em; }
.detail-value { font-size: 1rem; font-weight: 500; color: var(--text-primary); line-height: 1.4; word-break: break-word; display: flex; align-items: center; gap: 0.5em; /* Align icon buttons */ }
.detail-value.emphasis { font-size: 1.3rem; font-weight: 600; display: block; /* Name shouldn't have buttons next to it */ }
.detail-value code, code.detail-value { /* Code styling within value */ font-family: var(--font-family-monospace); background-color: var(--bg-tertiary); padding: 0.1em 0.4em; border-radius: var(--border-radius-small); font-size: 95%; color: var(--text-secondary); border: 1px solid var(--border-color-light); word-break: break-all; }
code.detail-value.small-code { font-size: 85%; /* Smaller code for less prominent info */ }
.detail-value.detail-link { font-family: var(--font-family-sans-serif); word-break: break-all; display: inline; } /* Links shouldn't use flex gap */
.detail-value.detail-link:not([href="#"]):not([href=""]) { color: var(--text-link); text-decoration: underline; text-underline-offset: 2px; }
.detail-value.detail-link:not([href="#"]):not([href=""]):hover { color: var(--primary-hover-color); }
.detail-value.detail-link[href="#"], .detail-value.detail-link[href=""], .detail-value[aria-disabled="true"] { color: var(--text-muted); font-style: italic; pointer-events: none; text-decoration: none; }
.detail-description-text { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; max-width: 75ch; }
/* Details Action Buttons */
.action-buttons-container { padding-top: calc(var(--spacing-unit) * 1.5); }
.details-actions-grid { display: flex; flex-wrap: wrap; gap: var(--spacing-unit); position: relative; min-height: 40px; }
#enable-toggle-button.enabled { background-color: rgba(var(--success-rgb), 0.1); color: var(--text-success); border-color: transparent; font-weight: 600; }
#enable-toggle-button.enabled:hover { background-color: rgba(var(--success-rgb), 0.15); }
#enable-toggle-button.enabled .icon { color: var(--success-color); }

/* ==========================================================================
 Permissions Panel Specifics (Enhanced UI, Search, Layout, Risk)
 ========================================================================== */

/* Controls (Search & Layout Toggle) */
.permissions-controls { display: flex; justify-content: space-between; align-items: center; gap: var(--spacing-unit); margin-bottom: calc(var(--spacing-unit) * 1.5); padding-bottom: var(--spacing-unit); border-bottom: 1px solid var(--border-color-light); flex-wrap: wrap; }
.permissions-search { position: relative; flex-grow: 1; max-width: 400px; }
#permission-search-input { width: 100%; padding: 0.6rem 0.8rem 0.6rem 2.5rem; /* Space for icon */ font-family:var(--font-family-sans-serif); font-size: 0.95rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-small); background-color: var(--bg-primary); color: var(--text-primary); transition: border-color var(--transition-speed-fast), box-shadow var(--transition-speed-fast); }
#permission-search-input:focus { border-color: var(--primary-color); box-shadow: var(--focus-ring); outline: none; }
#permission-search-input::placeholder { color: var(--text-muted); }
#permission-search-input::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; height: 1em; width: 1em; margin-left: .4em; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" fill="%23999"><path d="M8.4 8.4L5 5m3.4-3.4L5 5M1.6 8.4L5 5m-3.4-3.4L5 5" stroke="%23666" stroke-width="1.5" stroke-linecap="round"/></svg>') center/1em no-repeat; cursor: pointer; opacity: 0.7; }
#permission-search-input:focus::-webkit-search-cancel-button { opacity: 1; }
.permissions-layout-toggle { display: flex; gap: calc(var(--spacing-unit) * 0.5); }

/* Permissions List Styling (List & Grid) */
.permissions-list { margin-top: calc(var(--spacing-unit) * 0.5); }
.permissions-list.list-view { display: flex; flex-direction: column; gap: var(--spacing-unit); }
.permissions-list.grid-view { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-unit); }

.permission-item { background-color: var(--bg-primary); border: 1px solid var(--border-color); border-left-width: 4px; /* For risk color border */ border-radius: var(--border-radius-small); padding: calc(var(--spacing-unit) * 1); box-shadow: var(--shadow-sm); transition: box-shadow var(--transition-speed-fast), transform var(--transition-speed-fast); transform: scale(1); /* For hidden transition */ }
.permission-item:hover { box-shadow: var(--shadow); }
.permission-item[hidden] { display: block; /* Keep in layout */ visibility: hidden; opacity: 0; transform: scale(0.95); transition: opacity 0.2s ease, transform 0.2s ease; height: 0; padding: 0; border: none; margin: 0; overflow: hidden; } /* Hide smoothly */

.permission-item-header { display: flex; align-items: center; font-weight: 600; color: var(--text-primary); margin-bottom: 0.4em; font-size: 0.95rem; gap: 0.5em; /* Gap between icon, name, risk */ flex-wrap: wrap; /* Allow risk to wrap */ }
.permission-item-header .perm-name { font-weight: 600; }
.permission-item-header code { font-size: 0.9em; background-color: var(--bg-tertiary); padding: 0.1em 0.4em; border-radius: var(--border-radius-small); border: 1px solid var(--border-color-light); color: var(--text-secondary); }
.permission-item-description { /* Indent slightly */ margin-left: 0.2em; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; }

/* Risk Indicator Styling */
.risk-indicator { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; padding: 0.15em 0.5em; border-radius: var(--border-radius-small); margin-left: auto; /* Push to the right */ white-space: nowrap; }
.permission-item.risk-low { border-left-color: var(--risk-low-color); }
.permission-item.risk-medium { border-left-color: var(--risk-medium-color); }
.permission-item.risk-high { border-left-color: var(--risk-high-color); }
.permission-item.risk-varies { border-left-color: var(--risk-varies-color); }
.risk-indicator.low { background-color: var(--risk-low-bg); color: var(--risk-low-color); }
.risk-indicator.medium { background-color: var(--risk-medium-bg); color: var(--risk-medium-color); }
.risk-indicator.high { background-color: var(--risk-high-bg); color: var(--risk-high-color); }
.risk-indicator.varies { background-color: var(--risk-varies-bg); color: var(--risk-varies-color); }

/* Risk Legend */
.risk-legend { border-top: 1px solid var(--border-color-light); padding-top: var(--spacing-unit); margin-top: var(--spacing-unit); }
ul.risk-definitions { list-style: none; padding-left: 0; font-size: 0.85rem; color: var(--text-secondary); }
ul.risk-definitions li { margin-bottom: 0.5em; }
ul.risk-definitions .risk-indicator { margin-left: 0; margin-right: 0.5em; /* Space after indicator */ }


/* Placeholder Message */
.placeholder.info-message { display: flex; align-items: center; gap: 0.7em; font-size: 0.95rem; color: var(--text-muted); background-color: var(--bg-tertiary); padding: var(--spacing-unit); border-radius: var(--border-radius-small); border: 1px dashed var(--border-color); /* Dashed border */ }
.info-message .icon { width: 1.2em; height: 1.2em; }
.info-message .icon-loading { animation: spin 1s linear infinite; }

/* ==========================================================================
 Troubleshooting Panel Specifics - Minor tweaks
 ========================================================================== */
 .diagnosis-list {
  display: flex;
  flex-direction: column;
  gap: calc(var(--spacing-unit) * 1.25); /* Increase gap between items */
  min-height: 80px;
  position: relative;
}
.diag-item {
  display: flex;
  align-items: flex-start;
  /* padding: calc(var(--spacing-unit) * 0.9); */ /* Existing padding */
  padding: calc(var(--spacing-unit) * 1.1); /* Slightly increase internal padding */
  border-radius: var(--border-radius-small);
  border: 1px solid var(--border-color);
  background-color: var(--bg-primary);
  border-left-width: 4px;
}.diag-item .icon { margin-top: 0.1em; flex-shrink: 0; }
.diag-content { flex-grow: 1; }
.diag-message { font-weight: 500; color: var(--text-primary); display: block; margin-bottom: 0.2em; line-height: 1.4; }
.diag-suggestion { font-size: 0.85rem; color: var(--text-secondary); display: block; line-height: 1.4; margin-top: 0.3em; }
.diag-item.success { border-left-color: var(--success-color); background-color: rgba(var(--success-rgb), 0.05); border-color: rgba(var(--success-rgb), 0.2); }
.diag-item.warning { border-left-color: var(--warning-color); background-color: rgba(var(--warning-rgb), 0.05); border-color: rgba(var(--warning-rgb), 0.2); }
.diag-item.warning .diag-message { color: var(--text-warning); font-weight: 600; }
.diag-item.error { border-left-color: var(--danger-color); background-color: rgba(var(--danger-rgb), 0.05); border-color: rgba(var(--danger-rgb), 0.2); }
.diag-item.error .diag-message { color: var(--text-danger); font-weight: 600; }
.diag-item code {
  font-size: 90%; /* Slightly smaller than base code if needed */
  padding: 0.2em 0.5em; /* Slightly more padding */
  background-color: var(--bg-tertiary); /* Use existing variable */
  border: 1px solid var(--border-color); /* Use slightly darker border */
  color: var(--text-primary); /* Make code text slightly more prominent */
  border-radius: var(--border-radius-small);
  /* Ensure it doesn't break words inappropriately */
  word-break: keep-all; /* Prevent breaking within the code tag */
  white-space: nowrap; /* Prevent wrapping within the code tag */
  vertical-align: baseline; /* Align better with surrounding text */
}

.diag-item code:hover {
  background-color: var(--border-color);
}

#diag-action-items { display: flex; flex-wrap: wrap; gap: var(--spacing-unit); position: relative; min-height: 40px; }

/* ==========================================================================
 Toast Notifications - Same as Updates
 ========================================================================== */
#toast-container { position: fixed; bottom: var(--spacing-unit); right: var(--spacing-unit); z-index: 9999; display: flex; flex-direction: column; align-items: flex-end; gap: calc(var(--spacing-unit) * 0.75); max-width: 420px; pointer-events: none; }
.toast { background-color: var(--bg-primary); color: var(--text-primary); padding: 0.9rem 1.4rem; border-radius: var(--border-radius-small); font-size: 0.9rem; font-weight: 500; opacity: 0; transform: scale(0.95) translateY(10px); transform-origin: bottom right; transition: opacity var(--transition-speed-normal) ease, transform var(--transition-speed-normal) ease; box-shadow: var(--shadow-lg); border: var(--border-width) solid var(--border-color); border-left-width: 5px; pointer-events: auto; margin-bottom: 0.5rem; max-width: 100%; }
.toast.show { opacity: 1; transform: scale(1) translateY(0); }
.toast.success { border-left-color: var(--success-color); }
.toast.error { border-left-color: var(--danger-color); }
.toast.warning { border-left-color: var(--warning-color); }
.toast.info { border-left-color: var(--info-color); }

/* ==========================================================================
 Responsive Adjustments - Adjustments for new elements
 ========================================================================== */
@media (max-width: 900px) {
  :root { --sidebar-width: 65px; }
  .sidebar { padding: var(--spacing-unit) calc(var(--spacing-unit) * 0.5); }
  .sidebar-header { padding: var(--spacing-unit) 0; justify-content: center; }
  .header-logo { margin-right: 0; }
  .sidebar-title { display: none; }
  .sidebar-button span:not(.icon) { display: none; }
  .sidebar-button .icon { margin-right: 0; }
  .sidebar-button { justify-content: center; padding: calc(var(--spacing-unit) * 0.8); }
  .sidebar-footer { display: none; }
  .content-area { margin-left: var(--sidebar-width); padding: var(--container-padding); }
  .panel-header h2 { font-size: 1.6rem; }
  .panel-header p { font-size: 0.95rem; }
  .details-grid { grid-template-columns: 1fr; }
  .permissions-controls { flex-direction: column; align-items: stretch; }
  .permissions-search { max-width: none; }
}

@media (max-width: 600px) {
  :root { --base-font-size: 15px; }
  .page-wrapper { flex-direction: column; }
  .sidebar { position: static; width: 100%; height: auto; border-right: none; border-bottom: var(--border-width) solid var(--border-color); padding: calc(var(--spacing-unit)*0.5); box-shadow: none; z-index: auto; flex-direction: row; justify-content: space-around; overflow-x: auto; }
  .sidebar-header { display: none; }
  .sidebar-nav { flex-grow: 0; }
  .sidebar-nav ul { display: flex; gap: calc(var(--spacing-unit)*0.5); }
  .sidebar-nav li { margin-bottom: 0; }
  .sidebar-button { flex-direction: column; padding: calc(var(--spacing-unit)*0.5) calc(var(--spacing-unit)*0.7); font-size: 0.8rem; height: 60px; justify-content: center; white-space: normal; text-align: center; }
  .sidebar-button span:not(.icon) { display: block; margin-top: 0.2em; }
  .sidebar-button .icon { margin-right: 0; margin-bottom: 0.2em; width: 1.5em; height: 1.5em; }
  .sidebar-footer { display: none; }
  .content-area { margin-left: 0; padding: var(--spacing-unit); overflow-y: visible; }
  .panel-header { margin-bottom: var(--spacing-unit); }
  .panel-header h2 { font-size: 1.4rem; }
  .panel-header p { font-size: 0.9rem; }
  .panel-content { padding: var(--spacing-unit); gap: calc(var(--spacing-unit) * 1.5); }
  .content-section { padding-bottom: var(--spacing-unit); margin-bottom: var(--spacing-unit); }
  .details-grid { grid-template-columns: 1fr; gap: var(--spacing-unit); padding-top: 0; /* Remove padding inherit */ }
  .detail-value { font-size: 1rem; }
  .detail-value.emphasis { font-size: 1.2rem; }
  .details-actions-grid, #diag-action-items { flex-direction: column; align-items: stretch; }
  .details-actions-grid .btn, #diag-action-items .btn { width: 100%; }
  .permission-item { padding: calc(var(--spacing-unit)*0.8); }
  .permissions-list.grid-view { grid-template-columns: 1fr; } /* Force single column grid on small screens */
  #toast-container { right: var(--spacing-unit); bottom: var(--spacing-unit); max-width: calc(100% - var(--spacing-unit) * 2); }
}

/* ==========================================================================
 Reduced Motion Preferences - Same as Updates
 ========================================================================== */
@media (prefers-reduced-motion: reduce) {
  html { scroll-behavior: auto; }
  *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
  .spinner, .icon.loading { animation: none; }
  .toast.show { transform: scale(1) translateY(0); }
  .skeleton::after { animation: none; background: none; }
  .permission-item { transition: none; transform: none; }
  .permission-item[hidden] { transition: none; opacity: 0; visibility: hidden; }
}

/* ==========================================================================
 Utility Classes
 ========================================================================== */
.visually-hidden { position: absolute !important; width: 1px !important; height: 1px !important; padding: 0 !important; margin: -1px !important; overflow: hidden !important; clip: rect(0, 0, 0, 0) !important; white-space: nowrap !important; border: 0 !important; }
